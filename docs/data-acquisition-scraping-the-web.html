<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Topic 2 Data Acquisition: Scraping the Web | COMP/STAT 112: Introduction to Data Science</title>
  <meta name="description" content="This is the class website for Introduction to Data Science at Macalester College for Fall 2022." />
  <meta name="generator" content="bookdown 0.27.3 and GitBook 2.6.7" />

  <meta property="og:title" content="Topic 2 Data Acquisition: Scraping the Web | COMP/STAT 112: Introduction to Data Science" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/logo.png" />
  <meta property="og:description" content="This is the class website for Introduction to Data Science at Macalester College for Fall 2022." />
  <meta name="github-repo" content="bcheggeseth/112_fall_2022/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Topic 2 Data Acquisition: Scraping the Web | COMP/STAT 112: Introduction to Data Science" />
  
  <meta name="twitter:description" content="This is the class website for Introduction to Data Science at Macalester College for Fall 2022." />
  <meta name="twitter:image" content="/images/logo.png" />




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro-to-r-rstudio-and-r-markdown.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="custom_styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href = "./">COMP/STAT 112: Introduction to Data Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome!</a></li>
<li class="chapter" data-level="" data-path="course-schedule.html"><a href="course-schedule.html"><i class="fa fa-check"></i>Course Schedule</a></li>
<li class="chapter" data-level="" data-path="learning-goals.html"><a href="learning-goals.html"><i class="fa fa-check"></i>Learning Goals</a>
<ul>
<li class="chapter" data-level="" data-path="learning-goals.html"><a href="learning-goals.html#general-skills"><i class="fa fa-check"></i>General Skills</a></li>
<li class="chapter" data-level="" data-path="learning-goals.html"><a href="learning-goals.html#course-topics"><i class="fa fa-check"></i>Course Topics</a>
<ul>
<li class="chapter" data-level="" data-path="learning-goals.html"><a href="learning-goals.html#foundation"><i class="fa fa-check"></i>Foundation</a></li>
<li class="chapter" data-level="" data-path="learning-goals.html"><a href="learning-goals.html#data-acquisition"><i class="fa fa-check"></i>Data Acquisition</a></li>
<li class="chapter" data-level="" data-path="learning-goals.html"><a href="learning-goals.html#data-wrangling"><i class="fa fa-check"></i>Data Wrangling</a></li>
<li class="chapter" data-level="" data-path="learning-goals.html"><a href="learning-goals.html#data-visualization"><i class="fa fa-check"></i>Data Visualization</a></li>
<li class="chapter" data-level="" data-path="learning-goals.html"><a href="learning-goals.html#data-modeling"><i class="fa fa-check"></i>Data Modeling</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Foundation</b></span></li>
<li class="chapter" data-level="1" data-path="intro-to-r-rstudio-and-r-markdown.html"><a href="intro-to-r-rstudio-and-r-markdown.html"><i class="fa fa-check"></i><b>1</b> Intro to R, RStudio, and R Markdown</a>
<ul>
<li class="chapter" data-level="" data-path="intro-to-r-rstudio-and-r-markdown.html"><a href="intro-to-r-rstudio-and-r-markdown.html#learning-goals-1"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="intro-to-r-rstudio-and-r-markdown.html"><a href="intro-to-r-rstudio-and-r-markdown.html#getting-started-in-rstudio"><i class="fa fa-check"></i>Getting Started in RStudio</a>
<ul>
<li class="chapter" data-level="" data-path="intro-to-r-rstudio-and-r-markdown.html"><a href="intro-to-r-rstudio-and-r-markdown.html#download-r-rstudio"><i class="fa fa-check"></i>Download R &amp; RStudio</a></li>
<li class="chapter" data-level="" data-path="intro-to-r-rstudio-and-r-markdown.html"><a href="intro-to-r-rstudio-and-r-markdown.html#a-quick-tour-of-rstudio"><i class="fa fa-check"></i>A quick tour of RStudio</a></li>
<li class="chapter" data-level="" data-path="intro-to-r-rstudio-and-r-markdown.html"><a href="intro-to-r-rstudio-and-r-markdown.html#tidy-data"><i class="fa fa-check"></i>Tidy Data</a></li>
<li class="chapter" data-level="" data-path="intro-to-r-rstudio-and-r-markdown.html"><a href="intro-to-r-rstudio-and-r-markdown.html#data-basics-in-rstudio"><i class="fa fa-check"></i>Data Basics in RStudio</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="intro-to-r-rstudio-and-r-markdown.html"><a href="intro-to-r-rstudio-and-r-markdown.html#r-markdown-and-reproducible-research"><i class="fa fa-check"></i>R Markdown and Reproducible Research</a></li>
<li class="chapter" data-level="" data-path="intro-to-r-rstudio-and-r-markdown.html"><a href="intro-to-r-rstudio-and-r-markdown.html#practice"><i class="fa fa-check"></i>Practice</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-acquisition-scraping-the-web.html"><a href="data-acquisition-scraping-the-web.html"><i class="fa fa-check"></i><b>2</b> Data Acquisition: Scraping the Web</a>
<ul>
<li class="chapter" data-level="" data-path="data-acquisition-scraping-the-web.html"><a href="data-acquisition-scraping-the-web.html#learning-goals-2"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="data-acquisition-scraping-the-web.html"><a href="data-acquisition-scraping-the-web.html#scraping-data"><i class="fa fa-check"></i>Scraping Data</a>
<ul>
<li class="chapter" data-level="" data-path="data-acquisition-scraping-the-web.html"><a href="data-acquisition-scraping-the-web.html#finding-css-selectors"><i class="fa fa-check"></i>Finding CSS Selectors</a></li>
<li class="chapter" data-level="" data-path="data-acquisition-scraping-the-web.html"><a href="data-acquisition-scraping-the-web.html#retrieving-data-using-rvest-and-css-selector"><i class="fa fa-check"></i>Retrieving Data Using <code>rvest</code> and CSS Selector</a></li>
<li class="chapter" data-level="" data-path="data-acquisition-scraping-the-web.html"><a href="data-acquisition-scraping-the-web.html#web-scraping-in-python"><i class="fa fa-check"></i>Web Scraping in Python</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data-acquisition-scraping-the-web.html"><a href="data-acquisition-scraping-the-web.html#additional-practice-analyze-wnba-players"><i class="fa fa-check"></i>Additional Practice: Analyze WNBA Players</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">COMP/STAT 112: Introduction to Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-acquisition-scraping-the-web" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Topic 2</span> Data Acquisition: Scraping the Web<a href="data-acquisition-scraping-the-web.html#data-acquisition-scraping-the-web" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="learning-goals-2" class="section level2 unnumbered hasAnchor">
<h2>Learning Goals<a href="data-acquisition-scraping-the-web.html#learning-goals-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Develop comfort in using CSS Selectors and the Selector Gadget to identify data of interest within a website</li>
<li>Use <code>html_nodes</code> and <code>html_text</code> within <code>rvest</code> packages to scrape data from websites using CSS selectors</li>
<li>Develop initial comfort in cleaning text data</li>
</ul>
<p>You can download a template .Rmd of this activity <a href="template_rmd/13-Data_Scraping.Rmd">here</a>.</p>
</div>
<div id="scraping-data" class="section level2 unnumbered hasAnchor">
<h2>Scraping Data<a href="data-acquisition-scraping-the-web.html#scraping-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Additional readings:</p>
<ul>
<li><a href="https://www.analyticsvidhya.com/blog/2017/03/beginners-guide-on-web-scraping-in-r-using-rvest-with-hands-on-knowledge/">rvest</a><br />
</li>
<li><a href="https://css-tricks.com/how-css-selectors-work/">CSS selectors</a></li>
</ul>
<p>While a great deal of data is available via Web APIs, data download link, and data warehouses, not all of it is. Programs can use a process called <strong>web scraping</strong> to collect data that is available to humans (via web browsers) but not computer programs.</p>
<div id="finding-css-selectors" class="section level3 unnumbered hasAnchor">
<h3>Finding CSS Selectors<a href="data-acquisition-scraping-the-web.html#finding-css-selectors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In order to gather information from a webpage, we must learn the language used to identify patterns of specific information. For example, on the <a href="https://www.macalester.edu/registrar/schedules/2021fall/class-schedule">Macalester Registrar’s Fall 2021 Class Schedule</a> you can visually see that the data is represented in a table. The first column shows the course number, the second the title, etc.</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-75"></span>
<img src="images/registrar.png" alt="Subset of Macalester registration data for Fall 2021." width="1368" />
<p class="caption">
Figure 2.1: Subset of Macalester registration data for Fall 2021.
</p>
</div>
<p>We will identify data in a webpage using a pattern matching language called <a href="https://css-tricks.com/how-css-selectors-work/">CSS Selectors</a> that can refer to specific patterns in HTML, the language used to write web pages.</p>
<p>For example, the CSS selector “a” selects all hyperlinks in a webpage (“a” represents “anchor” links in HTML), “table &gt; tr &gt; td:nth-child(2)” would find the second column of an HTML table.</p>
<p><strong>Warning</strong>: Websites change often! So if you are going to scrape a lot of data, it is probably worthwhile to save and date a copy of the website. Otherwise, you may return after some time and your scraping code will include all of the wrong CSS selectors.</p>
<p>Although you can <a href="%5BCSS%20Selectors%5D(https://css-tricks.com/how-css-selectors-work/)">learn how to use CSS Selectors by hand</a>, we will use a shortcut by installing the <a href="http://selectorgadget.com/">Selector Gadget</a> for Chrome.</p>
<p>Yes, you must have the Chrome web browser installed to do this! You “teach” the Selector Gadget which data you are interested in on a web page, and it will show you the CSS Selector for this data. We will eventually use this selector in <code>R</code>.</p>
<p>First watch the <a href="http://selectorgadget.com/">Selector Gadget</a> video and install the Chrome Extension.</p>
<p>Head over to the <a href="https://www.macalester.edu/registrar/schedules/2021fall/class-schedule/">Macalester Registrar’s Fall 2021 class schedule</a>. Click the selector gadget icon in the top right corner of Chrome (you may need to click on the puzzle piece and then the pin icon next to the Selector). As you mouse over the webpage, different parts will be highlighted in orange. Click on the first course number, <code>AMST 194-01</code>. You’ll notice that the Selector Gadget information in the lower right describes what you clicked on:</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-76"></span>
<img src="images/SelectorGadgetActionShot2.png" alt="The Selector Gadget in action: Mousing over the course number (left), and the result pane after clicking on the course number (right)." width="1263" />
<p class="caption">
Figure 2.2: The Selector Gadget in action: Mousing over the course number (left), and the result pane after clicking on the course number (right).
</p>
</div>
<p>Scroll through the page to verify that only the information you intend (the course number) is selected. The selector panel shows the CSS selector (<code>.class-schedule-course-number</code>) and the number of matches for that CSS selector (763).</p>
<p>Now that we have the selector for the course number, let’s find the selector for the days of the week. Clear the selector by clicking the “Clear” button on the result pane, and then click the <code>MWF</code> under days for <code>AMST 194-01</code>. You will notice that the selector was too broad and highlighted information we don’t want. You need to teach Selector Gadget a correct selector by clicking the information you <strong>don’t want</strong> to turn it red. Once this is done, you should have 763 matches and a CSS selector of <code>.class-schedule-course-title+ .class-schedule-label</code>.</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-77"></span>
<img src="images/SelectorGadgetDay2.png" alt="Results for the Selector Gadget after selecting the day field." width="1264" />
<p class="caption">
Figure 2.3: Results for the Selector Gadget after selecting the day field.
</p>
</div>
<div class="exercise">
<p><span id="exr:unnamed-chunk-78" class="exercise"><strong>Exercise 2.1  </strong></span>Repeat the process above to find the correct selectors for the following fields. Make sure that each matches 763 results:</p>
</div>
<ol style="list-style-type: decimal">
<li>Course Number</li>
<li>Course Name</li>
<li>Day</li>
<li>Time</li>
<li>Room</li>
<li>Instructor</li>
<li>Avail. / Max</li>
</ol>
</div>
<div id="retrieving-data-using-rvest-and-css-selector" class="section level3 unnumbered hasAnchor">
<h3>Retrieving Data Using <code>rvest</code> and CSS Selector<a href="data-acquisition-scraping-the-web.html#retrieving-data-using-rvest-and-css-selector" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that we have identified CSS selectors for the information we need, let’s fetch the data in <code>R</code>. We will be using the <code>rvest</code> package, which retrieves information from a webpage and turns it into R data tables:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="data-acquisition-scraping-the-web.html#cb17-1" aria-hidden="true" tabindex="-1"></a>fall2021 <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">&quot;https://www.macalester.edu/registrar/schedules/2021fall/class-schedule&quot;</span>)</span></code></pre></div>
<p>Once the webpage is loaded, we can retrieve data using the CSS selectors we specified earlier. The following code retrieves the course numbers and names as a vector:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="data-acquisition-scraping-the-web.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve and inspect course numbers</span></span>
<span id="cb18-2"><a href="data-acquisition-scraping-the-web.html#cb18-2" aria-hidden="true" tabindex="-1"></a>course_nums <span class="ot">&lt;-</span></span>
<span id="cb18-3"><a href="data-acquisition-scraping-the-web.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  fall2021 <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="data-acquisition-scraping-the-web.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;.class-schedule-course-number&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="data-acquisition-scraping-the-web.html#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb18-6"><a href="data-acquisition-scraping-the-web.html#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(course_nums)</span></code></pre></div>
<pre><code>## [1] &quot;AMST 194-01 10068&quot;
## [2] &quot;AMST 194-02 10069&quot;
## [3] &quot;AMST 209-01 10781&quot;
## [4] &quot;AMST 219-01 10782&quot;
## [5] &quot;AMST 225-01 10420&quot;
## [6] &quot;AMST 240-01 10271&quot;</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="data-acquisition-scraping-the-web.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve and inspect course names</span></span>
<span id="cb20-2"><a href="data-acquisition-scraping-the-web.html#cb20-2" aria-hidden="true" tabindex="-1"></a>course_names <span class="ot">&lt;-</span></span>
<span id="cb20-3"><a href="data-acquisition-scraping-the-web.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  fall2021 <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="data-acquisition-scraping-the-web.html#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;.class-schedule-course-title&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="data-acquisition-scraping-the-web.html#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb20-6"><a href="data-acquisition-scraping-the-web.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(course_names)</span></code></pre></div>
<pre><code>## [1] &quot;The Obama Presidency&quot;                                                              
## [2] &quot;Introduction to Asian American Studies&quot;                                            
## [3] &quot;Civil Rights Movement&quot;                                                             
## [4] &quot;In Motion: African Americans in the US (African Americans in Digital Technologies)&quot;
## [5] &quot;Native History to 1871&quot;                                                            
## [6] &quot;Race, Culture, and Ethnicity in Education&quot;</code></pre>
<p>At the end of each course number entry is a 5 digit number, which is CRN number used internally for the registrar’s office. Let’s put that in its own variable.</p>
<p>To clean up the course number data, we can chop off the last 6 characters of each entry using the command <code>sub_str</code> from the <code>stringr</code> package:<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="data-acquisition-scraping-the-web.html#cb22-1" aria-hidden="true" tabindex="-1"></a>course_nums_clean <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_sub</span>(course_nums, <span class="at">end =</span> <span class="fu">nchar</span>(course_nums) <span class="sc">-</span> <span class="dv">6</span>)</span>
<span id="cb22-2"><a href="data-acquisition-scraping-the-web.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(course_nums_clean)</span></code></pre></div>
<pre><code>## [1] &quot;AMST 194-01&quot; &quot;AMST 194-02&quot;
## [3] &quot;AMST 209-01&quot; &quot;AMST 219-01&quot;
## [5] &quot;AMST 225-01&quot; &quot;AMST 240-01&quot;</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="data-acquisition-scraping-the-web.html#cb24-1" aria-hidden="true" tabindex="-1"></a>crn <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_sub</span>(course_nums, <span class="at">start =</span> <span class="fu">nchar</span>(course_nums) <span class="sc">-</span> <span class="dv">4</span>)</span>
<span id="cb24-2"><a href="data-acquisition-scraping-the-web.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(crn)</span></code></pre></div>
<pre><code>## [1] &quot;10068&quot; &quot;10069&quot; &quot;10781&quot; &quot;10782&quot;
## [5] &quot;10420&quot; &quot;10271&quot;</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="data-acquisition-scraping-the-web.html#cb26-1" aria-hidden="true" tabindex="-1"></a>course_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">number =</span> course_nums_clean,<span class="at">crn =</span> crn, <span class="at">name =</span> course_names)</span>
<span id="cb26-2"><a href="data-acquisition-scraping-the-web.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(course_df)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   number      crn   name             
##   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;            
## 1 AMST 194-01 10068 The Obama Presid…
## 2 AMST 194-02 10069 Introduction to …
## 3 AMST 209-01 10781 Civil Rights Mov…
## 4 AMST 219-01 10782 In Motion: Afric…
## 5 AMST 225-01 10420 Native History t…
## 6 AMST 240-01 10271 Race, Culture, a…</code></pre>
<p>What happens when we try to grab the instructors in the same manner?</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="data-acquisition-scraping-the-web.html#cb28-1" aria-hidden="true" tabindex="-1"></a>course_instructors <span class="ot">&lt;-</span></span>
<span id="cb28-2"><a href="data-acquisition-scraping-the-web.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  fall2021 <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="data-acquisition-scraping-the-web.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;.class-schedule-label:nth-child(6)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="data-acquisition-scraping-the-web.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb28-5"><a href="data-acquisition-scraping-the-web.html#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(course_instructors)</span></code></pre></div>
<pre><code>## [1] &quot;\n                    Instructor: Duchess Harris\n                &quot;   
## [2] &quot;\n                    Instructor: Jake Nagasawa\n                &quot;    
## [3] &quot;\n                    Instructor: Walter Greason\n                &quot;   
## [4] &quot;\n                    Instructor: Walter Greason\n                &quot;   
## [5] &quot;\n                    Instructor: Katrina Phillips\n                &quot; 
## [6] &quot;\n                    Instructor: Jonathan Hamilton\n                &quot;</code></pre>
<p>In front of each entry is a bunch of spaces and “Instructor:”, which we don’t really need stored in every entry of our data table. This is because the website is set up in a responsive manner to change when the browser window is narrowed or you are on a mobile device.</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-83"></span>
<img src="images/registrar-narrow.png" alt="View of the schedule when the browser window is narrower." width="500" />
<p class="caption">
Figure 2.4: View of the schedule when the browser window is narrower.
</p>
</div>
<p>To clean up the data, we can chop off the white space with <code>trimws</code> and then first 12 characters of each entry using the command <code>sub_str</code> from the <code>stringr</code> package:<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="data-acquisition-scraping-the-web.html#cb30-1" aria-hidden="true" tabindex="-1"></a>course_instructors_short <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_sub</span>(<span class="fu">trimws</span>(course_instructors), <span class="at">start =</span> <span class="dv">13</span>)</span>
<span id="cb30-2"><a href="data-acquisition-scraping-the-web.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(course_instructors_short)</span></code></pre></div>
<pre><code>## [1] &quot;Duchess Harris&quot;   
## [2] &quot;Jake Nagasawa&quot;    
## [3] &quot;Walter Greason&quot;   
## [4] &quot;Walter Greason&quot;   
## [5] &quot;Katrina Phillips&quot; 
## [6] &quot;Jonathan Hamilton&quot;</code></pre>
<div class="exercise">
<p><span id="exr:unnamed-chunk-85" class="exercise"><strong>Exercise 2.2  </strong></span>Create a data table that contains all the information about courses you found selectors for earlier (7 columns). Do not include any extraneous information like “Instructor:”.</p>
</div>
<div class="exercise">
<p><span id="exr:unnamed-chunk-86" class="exercise"><strong>Exercise 2.3  </strong></span>Create a chart that shows the number of sections offered per department. <em>Hint: The department is a substring of the course number</em>.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
</div>
<div class="exercise">
<p><span id="exr:unnamed-chunk-87" class="exercise"><strong>Exercise 2.4  </strong></span>Analyze the typical length of course names by department. To do so, create a <code>dplyr</code> pipeline that creates a new data table based on your courses data table, with the following changes:</p>
</div>
<ol style="list-style-type: decimal">
<li>New columns for the length of the title of a course and the length of the description of the course. Hint: <code>nchar</code>.</li>
<li>Remove departments that have fewer than 10 sections of courses. To do so, group by department, then remove observations in groups with fewer than 10 sections (Hint: use <code>filter</code> with <code>n()</code>). Then <code>ungroup</code> the data so it flattens it back into a regular data table. This is one of the rare cases when we will use <code>group_by</code> without <code>summarize</code>.</li>
<li>Create a visualization of the differences across groups in lengths of course names or course descriptions. Think carefully about the visualization you should be using!</li>
</ol>
<p><em>Note: If you’d like to see the html code for a website, in Chrome go to View &gt; Developer &gt; Developer Tools. Through this, we can see that all of the details about the course such as gen. ed. requirements, distributional requirements, and course description are contained on external links the correspond to the CRN numbers (#####): <a href="https://webapps.macalester.edu/registrardata/classdata/Fall2021/#####" class="uri">https://webapps.macalester.edu/registrardata/classdata/Fall2021/#####</a> If you’d like a challenge, use that CRN variable we created above to pull out the description and gen ed. requirements for each class and join that data with the course information data table.</em></p>
</div>
<div id="web-scraping-in-python" class="section level3 unnumbered hasAnchor">
<h3>Web Scraping in Python<a href="data-acquisition-scraping-the-web.html#web-scraping-in-python" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you prefer to use Python rather than <code>R</code>, there are also great web scraping tools in Python. The equivalent to <code>rvest</code> in Python is called <strong>BeautifulSoup</strong>. Here is a reference for learning web scraping in Python:</p>
<ul>
<li><a href="https://www.amazon.com/Web-Scraping-Python-Collecting-Modern/dp/1491910291/">Web Scraping with Python</a>, by Ryan Mitchell, O’Reilly, 2015 (the second version is <a href="https://www.amazon.com/Web-Scraping-Python-Collecting-Modern-dp-1491985577/dp/1491985577/ref=dp_ob_title_bk">here</a>)</li>
</ul>
</div>
</div>
<div id="additional-practice-analyze-wnba-players" class="section level2 unnumbered hasAnchor">
<h2>Additional Practice: Analyze WNBA Players<a href="data-acquisition-scraping-the-web.html#additional-practice-analyze-wnba-players" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="exercise">
<p><span id="exr:unnamed-chunk-88" class="exercise"><strong>Exercise 2.5  </strong></span>This is an open-ended activity that asks you to analyze data from <a href="https://www.basketball-reference.com/wnba/years/2021_per_game.html">Basketball-Reference.com</a>. For this task, you will need to scrape at Women’s NBA players statistics from 2021. You are welcome to pursue an analysis that interests you about these players. Here are some examples you might choose:</p>
<ul>
<li><p>Which players are “the most valuable” players?</p></li>
<li><p>How do teams compare in terms of their players?</p></li>
</ul>
</div>

</div>
</div>








<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>This is a simple example of text processing with regular expressions. We’ll learn how to deal with more complicated situations in the text processing unit.<a href="data-acquisition-scraping-the-web.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>This is a simple example of text processing with regular expressions. We’ll learn how to deal with more complicated situations in the text processing unit.<a href="data-acquisition-scraping-the-web.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Yes, COMP, STAT, and MATH are the same department, but for this exercise you can just show the results by four letter department code, e.g., with COMP, STAT, and MATH separate.<a href="data-acquisition-scraping-the-web.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro-to-r-rstudio-and-r-markdown.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
